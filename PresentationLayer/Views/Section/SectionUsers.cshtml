@model List<Application.DTOs.ProjectUserDto>
@{
    Layout = "TaskFlowLayout";
    ViewData["Title"] = "Section Users";
    var projectName = ViewBag.ProjectName ?? "Project";
}

<link rel="stylesheet" href="~/css/SectionUsersStyleSheet.css"/>

<div class="members-container">
    <div class="members-header">
        <div class="header-info">
            <h2>@projectName Team</h2>
            <p>In this project there are <strong>@Model.Count</strong> members.</p>
        </div>
        
        <button class="btn-invite" onclick="openShareModal()">
            <i class="fa-solid fa-user-plus"></i> Invite new members
        </button>
    </div>

    @if (Model.Count == 0)
    {
        <div class="empty-state">
            <i class="fa-solid fa-users-slash" style="font-size: 48px; margin-bottom: 20px; color: #dfe1e6;"></i>
            <p>There are no members for this project.</p>
        </div>
    }
    else
    {
        <ul class="members-list">
            @foreach (var member in Model)
            {
                <li class="member-row" id="row-@member.Id">
                    
                    <div class="member-avatar" style="background-color: @(member.User.ProfileColor ?? "#0079bf");">
                        @member.User.ProfileLetters
                        
                        @if (member.IsActive)
                        {
                            <span class="status-dot status-active" title="Online"></span>
                        }
                        else
                        {
                            <span class="status-dot status-inactive" title="Offline"></span>
                        }
                    </div>

                    <div class="member-info">
                        <span class="member-name">
                            @member.User.Name
                            @if (!string.IsNullOrEmpty(member.Title))
                            {
                                <span class="member-title-badge">@member.Title</span>
                            }
                        </span>
                        <div class="member-meta">
                            <i class="fa-regular fa-envelope"></i> @member.User.Email 
                            <span style="margin: 0 5px;">•</span> 
                            <i class="fa-regular fa-calendar"></i> Joined: @member.JoinedDate.ToString("dd MMM yyyy")
                        </div>
                    </div>

                    <div class="member-actions">
                        
                        <select class="role-select" onchange="updateMemberRole(this, @member.Id)">
                            <option value="Viewer" selected="@(member.Role.ToString() == "Viewer")">Viewer</option>
                            <option value="Member" selected="@(member.Role.ToString() == "Developer")">Developer</option>
                            <option value="Leader" selected="@(member.Role.ToString() == "Leader")">Leader</option>
                        </select>

                        <button class="btn-remove" onclick="removeMember(@member.Id, '@member.User.Name')" title="Remove member">
                            <i class="fa-regular fa-trash-can"></i>
                        </button>
                    </div>
                </li>
            }
        </ul>
    }
</div>

<script src="~/js/SectionUsersScript.js"></script>